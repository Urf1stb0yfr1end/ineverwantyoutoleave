name: TEST publish cosas.html then auto-revert to placeholder

on:
  workflow_dispatch:
    inputs:
      minutes_live:
        description: "How many minutes to keep the secret page live before reverting"
        required: true
        default: "3"

permissions:
  contents: write

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout main
        uses: actions/checkout@v4
        with:
          ref: main

      - name: Publish from secret into cosas.html
        env:
          COSAS_HTML: ${{ secrets.COSAS_HTML }}
        run: |
          if [ -z "$COSAS_HTML" ]; then
            echo "ERROR: COSAS_HTML secret is empty/missing."
            exit 1
          fi
          printf "%s" "$COSAS_HTML" > cosas.html

      - name: Commit and push (publish)
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add cosas.html
          git commit -m "TEST: publish cosas.html" || echo "No changes"
          git push origin main

      - name: Keep it live
        run: |
          MINS="${{ github.event.inputs.minutes_live }}"
          echo "Sleeping for $MINS minutes..."
          sleep $((MINS * 60))

      - name: Revert to placeholder
        run: |
          cat > cosas.html <<'HTML'
          <!doctype html>
          <html lang="en">
          <head>
            <meta charset="utf-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1" />
            <title>Cosas</title>
            <style>
              :root{
                --bg:#070a12;
                --text:#e9efff;
                --muted:#a4b3d4;
                --border:rgba(255,255,255,.12);
                --card:rgba(14,20,38,.78);
                --glow:rgba(255, 160, 200, .14);
                --glow2:rgba(120, 190, 255, .12);
              }
              body{
                margin:0;
                min-height:100vh;
                display:grid;
                place-items:center;
                font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
                color:var(--text);
                background:
                  radial-gradient(900px 520px at 18% -10%, #2a3f86 0%, transparent 55%),
                  radial-gradient(780px 480px at 92% 0%, #6b1c52 0%, transparent 55%),
                  radial-gradient(540px 340px at 45% 120%, #0b6b58 0%, transparent 55%),
                  var(--bg);
              }
              .card{
                width:min(780px, 92vw);
                border:1px solid var(--border);
                background:var(--card);
                border-radius:24px;
                padding:26px 22px;
                box-shadow:
                  0 22px 70px rgba(0,0,0,.62),
                  0 0 120px var(--glow),
                  0 0 140px var(--glow2);
                backdrop-filter: blur(9px);
              }
              .top{
                display:flex;
                align-items:center;
                gap:14px;
                margin-bottom:12px;
              }
              .badge{
                width:50px;
                height:50px;
                border-radius:16px;
                display:grid;
                place-items:center;
                border:1px solid var(--border);
                background:rgba(255,255,255,.07);
                font-size:22px;
                user-select:none;
              }
              h1{
                margin:0;
                font-size:22px;
                letter-spacing:.2px;
                line-height:1.1;
              }
              .sub{
                margin-top:4px;
                color:rgba(233,239,255,.88);
                font-size:12px;
                opacity:.9;
              }
              p{
                margin:10px 0 0;
                color:var(--muted);
                line-height:1.6;
                font-size:14px;
              }
              .pillrow{
                display:flex;
                gap:10px;
                flex-wrap:wrap;
                margin-top:16px;
              }
              .pill{
                font-size:12px;
                color:rgba(233,240,255,.92);
                border:1px solid var(--border);
                background:rgba(255,255,255,.07);
                padding:8px 10px;
                border-radius:999px;
                user-select:none;
              }
              .footer{
                margin-top:18px;
                padding-top:14px;
                border-top:1px solid rgba(255,255,255,.08);
                display:flex;
                flex-wrap:wrap;
                gap:10px;
                justify-content:space-between;
                align-items:center;
              }
              a{
                color:var(--text);
                text-decoration:none;
                border-bottom:1px dotted rgba(255,255,255,.25);
              }
              code{
                font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
                font-size:12px;
                color:#cfe1ff;
              }
              .tiny{
                font-size:12px;
                opacity:.85;
                color:rgba(164,179,212,.95);
              }
              .wink{
                color:rgba(233,239,255,.95);
              }
            </style>
          </head>
          <body>
            <main class="card">
              <div class="top">
                <div class="badge">üïØÔ∏è</div>
                <div>
                  <h1>Cosas</h1>
                  <div class="sub"><code>cosas.html</code></div>
                </div>
              </div>

              <p class="wink">
                üöß Not live yet.
                <br>
                The contents of this page are on a timer‚Ä¶ and I‚Äôm still here.
              </p>

              <p>
                This is a scheduled release page. Until the day it opens, it stays shut.
                If you were hoping for the reveal early: nice try üòå
              </p>

              <div class="pillrow">
                <span class="pill">‚úÖ Not dead yet</span>
                <span class="pill">‚è≥ Dead-man switch armed</span>
                <span class="pill">üîí Content sealed</span>
                <span class="pill">‚öôÔ∏è GitHub Actions</span>
              </div>

              <p class="tiny" style="margin-top:14px;">
                If you‚Äôre seeing this, it means the ‚Äúboom‚Äù condition hasn‚Äôt been met.
                Come back later. Or don‚Äôt. Fate is flexible.
              </p>

              <div class="footer">
                <div class="tiny">Home: <a href="./index.html">index.html</a></div>
                <div class="tiny">Status: <span class="wink">alive</span> ‚úÖ</div>
              </div>
            </main>
          </body>
          </html>
          HTML

          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add cosas.html
          git commit -m "TEST: revert cosas.html to placeholder" || echo "No changes"
          git push origin main
